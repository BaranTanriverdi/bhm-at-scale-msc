ai:
  fieldMeta:
    - confidence: 0.2
      needs_review: false
      path: $.business.executiveSummary
      repoSources:
        - commit: <redacted>
          endLine: 8
          kind: docs
          path: README.md
          startLine: 1
        - commit: <redacted>
          endLine: 80
          kind: code
          path: notebooks/01-preprocessing.ipynb
          startLine: 1
        - commit: <redacted>
          endLine: 120
          kind: code
          path: notebooks/02-model.ipynb
          startLine: 1
      source:
        kind: inferred
    - confidence: 0.2
      needs_review: false
      path: $.business.hazardousUseCases
      repoSources:
        - commit: <redacted>
          endLine: 20
          kind: code
          path: LICENSE.txt
          startLine: 1
        - commit: <redacted>
          endLine: 20
          kind: docs
          path: README.md
          startLine: 1
      source:
        kind: inferred
    - confidence: 0.3
      needs_review: false
      path: $.business.intendedUse
      repoSources:
        - commit: <redacted>
          endLine: 32
          kind: docs
          path: README.md
          startLine: 1
        - commit: <redacted>
          endLine: 40
          kind: code
          path: notebooks/01-preprocessing.ipynb
          startLine: 1
        - commit: <redacted>
          endLine: 40
          kind: code
          path: notebooks/02-model.ipynb
          startLine: 1
      source:
        kind: inferred
    - confidence: 0.2
      needs_review: false
      path: $.business.nonGoals
      repoSources:
        - commit: <redacted>
          endLine: 16
          kind: docs
          path: README.md
          startLine: 1
        - commit: <redacted>
          endLine: 30
          kind: code
          path: setup.cfg
          startLine: 1
      source:
        kind: inferred
    - confidence: 0.2
      needs_review: false
      path: $.business.outOfScopeUse
      repoSources:
        - commit: <redacted>
          endLine: 80
          kind: code
          path: notebooks/01-preprocessing.ipynb
          startLine: 1
        - commit: <redacted>
          endLine: 120
          kind: code
          path: notebooks/02-model.ipynb
          startLine: 1
      source:
        kind: inferred
    - confidence: 0.9
      needs_review: false
      path: $.business.useCase
      repoSources:
        - commit: <redacted>
          endLine: 90
          kind: code
          path: notebooks/01-preprocessing.ipynb
          startLine: 30
        - commit: <redacted>
          endLine: 170
          kind: code
          path: notebooks/02-model.ipynb
          startLine: 60
        - commit: <redacted>
          endLine: 115
          kind: code
          path: src/bhm_at_scale/model.py
          startLine: 59
      source:
        kind: inferred
    - confidence: 0.2
      needs_review: false
      path: $.business.userPopulations
      repoSources:
        - commit: <redacted>
          endLine: 8
          kind: docs
          path: README.md
          startLine: 1
        - commit: <redacted>
          endLine: 40
          kind: code
          path: docs/index.rst
          startLine: 1
      source:
        kind: inferred
    - confidence: 0.3
      needs_review: false
      path: $.devInsight.architecture.dataFlow
      repoSources:
        - commit: <redacted>
          endLine: 120
          kind: code
          path: notebooks/01-preprocessing.ipynb
          startLine: 1
        - commit: <redacted>
          endLine: 160
          kind: code
          path: notebooks/02-model.ipynb
          startLine: 1
        - commit: <redacted>
          endLine: 140
          kind: code
          path: notebooks/03-evaluation.ipynb
          startLine: 1
        - commit: <redacted>
          endLine: 120
          kind: code
          path: src/bhm_at_scale/handler.py
          startLine: 1
        - commit: <redacted>
          endLine: 220
          kind: code
          path: src/bhm_at_scale/model.py
          startLine: 1
        - commit: <redacted>
          endLine: 80
          kind: code
          path: src/bhm_at_scale/preprocess.py
          startLine: 1
      source:
        kind: inferred
    - confidence: 0.2
      needs_review: false
      path: $.devInsight.architecture.depsSummary
      repoSources:
        - commit: <redacted>
          endLine: 120
          kind: config
          path: environment.lock.yaml
          startLine: 1
        - commit: <redacted>
          endLine: 40
          kind: config
          path: environment.yaml
          startLine: 1
        - commit: <redacted>
          endLine: 60
          kind: code
          path: notebooks/02-model.ipynb
          startLine: 1
        - commit: <redacted>
          endLine: 40
          kind: code
          path: notebooks/03-evaluation.ipynb
          startLine: 1
        - commit: <redacted>
          endLine: 80
          kind: code
          path: setup.cfg
          startLine: 40
      source:
        kind: extracted
    - confidence: 0.9
      needs_review: false
      path: $.devInsight.architecture.publicApis
      repoSources:
        - commit: <redacted>
          endLine: 100
          kind: code
          path: notebooks/01-preprocessing.ipynb
          startLine: 40
        - commit: <redacted>
          endLine: 80
          kind: code
          path: notebooks/02-model.ipynb
          startLine: 40
        - commit: <redacted>
          endLine: 80
          kind: code
          path: notebooks/03-evaluation.ipynb
          startLine: 40
        - commit: <redacted>
          endLine: 150
          kind: code
          path: src/bhm_at_scale/handler.py
          startLine: 1
        - commit: <redacted>
          endLine: 260
          kind: code
          path: src/bhm_at_scale/model.py
          startLine: 1
        - commit: <redacted>
          endLine: 120
          kind: code
          path: src/bhm_at_scale/plot.py
          startLine: 1
        - commit: <redacted>
          endLine: 80
          kind: code
          path: src/bhm_at_scale/preprocess.py
          startLine: 1
      source:
        kind: inferred
    - confidence: 0.2
      needs_review: false
      path: $.devInsight.codeOverview.components
      repoSources:
        - commit: <redacted>
          endLine: 120
          kind: code
          path: notebooks/01-preprocessing.ipynb
          startLine: 1
        - commit: <redacted>
          endLine: 200
          kind: code
          path: notebooks/02-model.ipynb
          startLine: 1
        - commit: <redacted>
          endLine: 200
          kind: code
          path: notebooks/03-evaluation.ipynb
          startLine: 1
        - commit: <redacted>
          endLine: 150
          kind: code
          path: src/bhm_at_scale/handler.py
          startLine: 1
        - commit: <redacted>
          endLine: 260
          kind: code
          path: src/bhm_at_scale/model.py
          startLine: 1
        - commit: <redacted>
          endLine: 200
          kind: code
          path: src/bhm_at_scale/plot.py
          startLine: 1
        - commit: <redacted>
          endLine: 80
          kind: code
          path: src/bhm_at_scale/preprocess.py
          startLine: 1
        - commit: <redacted>
          endLine: 180
          kind: code
          path: src/bhm_at_scale/utils.py
          startLine: 1
      source:
        kind: inferred
    - confidence: 0.3
      needs_review: false
      path: $.devInsight.codeOverview.entrypoints
      repoSources:
        - commit: <redacted>
          endLine: 40
          kind: docs
          path: README.md
          startLine: 21
        - commit: <redacted>
          endLine: 10
          kind: code
          path: notebooks/01-preprocessing.ipynb
          startLine: 1
        - commit: <redacted>
          endLine: 10
          kind: code
          path: notebooks/02-model.ipynb
          startLine: 1
        - commit: <redacted>
          endLine: 10
          kind: code
          path: notebooks/03-evaluation.ipynb
          startLine: 1
      source:
        kind: inferred
    - confidence: 0.99
      needs_review: false
      path: $.devInsight.codeOverview.languages
      repoSources:
        - commit: <redacted>
          endLine: 20
          kind: config
          path: environment.yaml
          startLine: 1
        - commit: <redacted>
          endLine: 30
          kind: code
          path: setup.cfg
          startLine: 1
        - commit: <redacted>
          endLine: 20
          kind: code
          path: src/bhm_at_scale/model.py
          startLine: 1
      source:
        kind: inferred
    - confidence: 0.4
      needs_review: false
      path: $.devInsight.runtimePerf
      repoSources:
        - commit: <redacted>
          endLine: 120
          kind: code
          path: notebooks/02-model.ipynb
          startLine: 80
        - commit: <redacted>
          endLine: 130
          kind: code
          path: src/bhm_at_scale/handler.py
          startLine: 60
        - commit: <redacted>
          endLine: 140
          kind: code
          path: src/bhm_at_scale/model.py
          startLine: 59
      source:
        kind: inferred
    - confidence: 0.5
      needs_review: false
      path: $.governance.policies
      repoSources:
        - commit: <redacted>
          endLine: 40
          kind: code
          path: LICENSE.txt
          startLine: 1
        - commit: <redacted>
          endLine: 8
          kind: docs
          path: README.md
          startLine: 3
        - commit: <redacted>
          endLine: 15
          kind: code
          path: setup.cfg
          startLine: 5
      source:
        kind: extracted
    - confidence: 0.2
      needs_review: false
      path: $.integration.driftSignals
      repoSources:
        - commit: <redacted>
          endLine: 160
          kind: code
          path: notebooks/03-evaluation.ipynb
          startLine: 80
      source:
        kind: inferred
    - confidence: 0.3
      needs_review: false
      path: $.integration.errorModel
      repoSources:
        - commit: <redacted>
          endLine: 170
          kind: code
          path: notebooks/02-model.ipynb
          startLine: 100
        - commit: <redacted>
          endLine: 100
          kind: code
          path: notebooks/03-evaluation.ipynb
          startLine: 40
        - commit: <redacted>
          endLine: 140
          kind: code
          path: src/bhm_at_scale/model.py
          startLine: 59
        - commit: <redacted>
          endLine: 40
          kind: code
          path: src/bhm_at_scale/utils.py
          startLine: 1
      source:
        kind: inferred
    - confidence: 0.2
      needs_review: false
      path: $.integration.fallbacks
      repoSources:
        - commit: <redacted>
          endLine: 210
          kind: code
          path: notebooks/02-model.ipynb
          startLine: 130
      source:
        kind: extracted
    - confidence: 0.4
      needs_review: false
      path: $.integration.observability
      repoSources:
        - commit: <redacted>
          endLine: 190
          kind: code
          path: notebooks/02-model.ipynb
          startLine: 110
        - commit: <redacted>
          endLine: 160
          kind: code
          path: notebooks/03-evaluation.ipynb
          startLine: 1
        - commit: <redacted>
          endLine: 200
          kind: code
          path: src/bhm_at_scale/plot.py
          startLine: 1
      source:
        kind: inferred
    - confidence: 0.3
      needs_review: false
      path: $.integration.operationalQualities
      repoSources:
        - commit: <redacted>
          endLine: 30
          kind: config
          path: environment.yaml
          startLine: 1
        - commit: <redacted>
          endLine: 120
          kind: code
          path: notebooks/01-preprocessing.ipynb
          startLine: 1
        - commit: <redacted>
          endLine: 140
          kind: code
          path: notebooks/02-model.ipynb
          startLine: 1
      source:
        kind: inferred
    - confidence: 0.99
      needs_review: false
      path: $.meta.links
      repoSources:
        - commit: <redacted>
          endLine: 8
          kind: docs
          path: README.md
          startLine: 1
        - commit: <redacted>
          endLine: 15
          kind: code
          path: setup.cfg
          startLine: 7
      source:
        kind: extracted
    - confidence: 0.82
      needs_review: false
      path: $.meta.maturity
      repoSources:
        - commit: <redacted>
          endLine: 16
          kind: docs
          path: README.md
          startLine: 1
        - commit: <redacted>
          endLine: 30
          kind: code
          path: setup.cfg
          startLine: 20
      source:
        kind: inferred
    - confidence: 0.98
      needs_review: false
      path: $.meta.owners
      repoSources:
        - commit: <redacted>
          endLine: 6
          kind: code
          path: AUTHORS.rst
          startLine: 1
        - commit: <redacted>
          endLine: 8
          kind: code
          path: setup.cfg
          startLine: 3
      source:
        kind: extracted
    - confidence: 0.8
      needs_review: false
      path: $.meta.tags
      repoSources:
        - commit: <redacted>
          endLine: 8
          kind: docs
          path: README.md
          startLine: 1
        - commit: <redacted>
          endLine: 30
          kind: config
          path: environment.yaml
          startLine: 10
        - commit: <redacted>
          endLine: 40
          kind: code
          path: src/bhm_at_scale/model.py
          startLine: 1
      source:
        kind: inferred
    - confidence: 0.99
      needs_review: false
      path: $.meta.title
      repoSources:
        - commit: <redacted>
          endLine: 1
          kind: docs
          path: README.md
          startLine: 1
      source:
        kind: extracted
    - confidence: 0.88
      needs_review: false
      path: $.mlCore.artifactURIs
      repoSources:
        - commit: <redacted>
          endLine: 110
          kind: code
          path: notebooks/02-model.ipynb
          startLine: 80
      source:
        kind: extracted
    - confidence: 0.92
      needs_review: false
      path: $.mlCore.baselines
      repoSources:
        - commit: <redacted>
          endLine: 110
          kind: config
          path: environment.lock.yaml
          startLine: 80
        - commit: <redacted>
          endLine: 200
          kind: code
          path: notebooks/02-model.ipynb
          startLine: 130
      source:
        kind: extracted
    - confidence: 0.9
      needs_review: false
      path: $.mlCore.datasets
      repoSources:
        - commit: <redacted>
          endLine: 40
          kind: code
          path: notebooks/01-preprocessing.ipynb
          startLine: 20
      source:
        kind: extracted
    - confidence: 0.7
      needs_review: false
      path: $.mlCore.failureModes
      repoSources:
        - commit: <redacted>
          endLine: 90
          kind: code
          path: notebooks/01-preprocessing.ipynb
          startLine: 60
        - commit: <redacted>
          endLine: 140
          kind: code
          path: src/bhm_at_scale/model.py
          startLine: 33
      source:
        kind: inferred
    - confidence: 0.98
      needs_review: false
      path: $.mlCore.features
      repoSources:
        - commit: <redacted>
          endLine: 58
          kind: code
          path: src/bhm_at_scale/model.py
          startLine: 33
      source:
        kind: extracted
    - confidence: 0.4
      needs_review: false
      path: $.mlCore.problem
      repoSources:
        - commit: <redacted>
          endLine: 120
          kind: code
          path: notebooks/02-model.ipynb
          startLine: 40
        - commit: <redacted>
          endLine: 140
          kind: code
          path: src/bhm_at_scale/model.py
          startLine: 59
      source:
        kind: inferred
    - confidence: 0.3
      needs_review: false
      path: $.mlCore.qualities
      repoSources:
        - commit: <redacted>
          endLine: 210
          kind: code
          path: notebooks/02-model.ipynb
          startLine: 130
        - commit: <redacted>
          endLine: 160
          kind: code
          path: notebooks/03-evaluation.ipynb
          startLine: 80
        - commit: <redacted>
          endLine: 40
          kind: code
          path: src/bhm_at_scale/utils.py
          startLine: 1
      source:
        kind: inferred
    - confidence: 0.4
      needs_review: false
      path: $.mlCore.training
      repoSources:
        - commit: <redacted>
          endLine: 170
          kind: config
          path: environment.lock.yaml
          startLine: 120
        - commit: <redacted>
          endLine: 120
          kind: code
          path: notebooks/02-model.ipynb
          startLine: 60
        - commit: <redacted>
          endLine: 120
          kind: code
          path: src/bhm_at_scale/handler.py
          startLine: 20
      source:
        kind: inferred
    - confidence: 0.2
      needs_review: false
      path: $.provenance.changelog
      repoSources:
        - commit: <redacted>
          endLine: 12
          kind: code
          path: CHANGELOG.rst
          startLine: 1
      source:
        kind: extracted
    - confidence: 0.2
      needs_review: false
      path: $.provenance.changelog[0]
      repoSources:
        - commit: <redacted>
          endLine: 1
          path: .coveragerc
          startLine: 1
        - commit: <redacted>
          endLine: 1
          path: .gitignore
          startLine: 1
        - commit: <redacted>
          endLine: 1
          path: .isort.cfg
          startLine: 1
        - commit: <redacted>
          endLine: 1
          path: .pre-commit-config.yaml
          startLine: 1
        - commit: <redacted>
          endLine: 1
          path: AUTHORS.rst
          startLine: 1
        - commit: <redacted>
          endLine: 1
          path: CHANGELOG.rst
          startLine: 1
        - commit: <redacted>
          endLine: 1
          path: LICENSE.txt
          startLine: 1
        - commit: <redacted>
          endLine: 1
          path: README.md
          startLine: 1
        - commit: <redacted>
          endLine: 1
          path: data/.gitignore
          startLine: 1
        - commit: <redacted>
          endLine: 1
          path: data/external/.gitignore
          startLine: 1
        - commit: <redacted>
          endLine: 1
          path: data/interim/.gitignore
          startLine: 1
        - commit: <redacted>
          endLine: 1
          path: data/preprocessed/.gitignore
          startLine: 1
        - commit: <redacted>
          endLine: 1
          path: data/raw/.gitignore
          startLine: 1
        - commit: <redacted>
          endLine: 1
          path: data/result/.gitignore
          startLine: 1
        - commit: <redacted>
          endLine: 1
          path: docs/Makefile
          startLine: 1
        - commit: <redacted>
          endLine: 1
          path: docs/_static/.gitignore
          startLine: 1
        - commit: <redacted>
          endLine: 1
          path: docs/authors.rst
          startLine: 1
        - commit: <redacted>
          endLine: 1
          path: docs/changelog.rst
          startLine: 1
        - commit: <redacted>
          endLine: 1
          path: docs/conf.py
          startLine: 1
        - commit: <redacted>
          endLine: 1
          path: docs/index.rst
          startLine: 1
        - commit: <redacted>
          endLine: 1
          path: docs/license.rst
          startLine: 1
        - commit: <redacted>
          endLine: 1
          path: docs/ml_system_card.yaml
          startLine: 1
        - commit: <redacted>
          endLine: 1
          path: docs/stakeholders.yaml
          startLine: 1
        - commit: <redacted>
          endLine: 1
          path: environment.lock.yaml
          startLine: 1
        - commit: <redacted>
          endLine: 1
          path: environment.yaml
          startLine: 1
        - commit: <redacted>
          endLine: 1
          path: notebooks/01-preprocessing.ipynb
          startLine: 1
        - commit: <redacted>
          endLine: 1
          path: notebooks/02-model.ipynb
          startLine: 1
        - commit: <redacted>
          endLine: 1
          path: notebooks/03-evaluation.ipynb
          startLine: 1
        - commit: <redacted>
          endLine: 1
          path: setup.cfg
          startLine: 1
        - commit: <redacted>
          endLine: 1
          path: setup.py
          startLine: 1
        - commit: <redacted>
          endLine: 1
          path: src/bhm_at_scale/__init__.py
          startLine: 1
        - commit: <redacted>
          endLine: 1
          path: src/bhm_at_scale/handler.py
          startLine: 1
        - commit: <redacted>
          endLine: 1
          path: src/bhm_at_scale/model.py
          startLine: 1
        - commit: <redacted>
          endLine: 1
          path: src/bhm_at_scale/plot.py
          startLine: 1
        - commit: <redacted>
          endLine: 1
          path: src/bhm_at_scale/preprocess.py
          startLine: 1
        - commit: <redacted>
          endLine: 1
          path: src/bhm_at_scale/utils.py
          startLine: 1
        - commit: <redacted>
          endLine: 1
          path: tests/conftest.py
          startLine: 1
      source:
        kind: extracted
business:
  executiveSummary: >-
    This project provides accompanying source code for the blog post “Finally! Bayesian Hierarchical Modelling at
    Scale,” demonstrating how to build a scalable Gamma-Poisson Bayesian hierarchical model for daily retail sales
    forecasting across many stores using JAX and NumPyro. Raw Rossmann store sales data from Kaggle is downloaded and
    transformed into a feature cube combining sales history, promotions, holidays, and store metadata. The model is
    trained via stochastic variational inference and compared qualitatively against a conventional linear regression
    baseline to highlight reduced overfitting and better use of partial pooling across stores. The code is organized as
    an end-to-end, notebook-driven workflow for experimentation and education rather than as a production service.
  hazardousUseCases:
    - >-
      Using the example model outputs as-is for high-stakes, real-time business decisions (e.g., automated pricing,
      staffing, or supply-chain control) without additional validation and monitoring.
    - >-
      Applying this demonstration code to regulated or safety-critical domains (such as healthcare, energy
      infrastructure, or credit risk) without domain-specific adaptation, governance, and expert review.
  intendedUse: >-
    The system is intended as an educational and experimental implementation demonstrating scalable Bayesian
    hierarchical modelling for store-level sales forecasting on the Rossmann Kaggle dataset, to be run via Jupyter
    notebooks by technically proficient users who can inspect, adapt, and validate the model and preprocessing for their
    own contexts.
  kpis: []
  nonGoals:
    - Provide a fully engineered, production-ready forecasting service or API.
    - Offer a general-purpose time series forecasting library with automated model selection and hyperparameter tuning.
    - >-
      Guarantee performance or support for commercial deployments; the repository is positioned as accompanying code for
      a blog post and educational example.
  outOfScopeUse:
    - Operating the notebooks and scripts as a long-running production service handling continuous data ingestion.
    - >-
      Using the provided model configuration as a drop-in solution for arbitrary datasets without re-validation of
      assumptions and preprocessing steps.
  useCase: >-
    Forecast daily sales for many retail stores simultaneously by fitting a Gamma-Poisson Bayesian hierarchical model
    that pools information across stores using features such as promotions, holidays, weekdays, and store variants.
  userPopulations:
    - >-
      Data scientists and machine learning practitioners interested in Bayesian hierarchical modelling and probabilistic
      forecasting at scale.
    - Researchers or advanced practitioners exploring JAX and NumPyro for hierarchical models and variational inference.
    - >-
      Python developers following the referenced blog post to reproduce or adapt the modelling workflow to similar
      retail sales problems.
devInsight:
  architecture:
    dataFlow:
      - Kaggle API downloads the 'pratyushakar/rossmann-store-sales' dataset into data/raw (store.csv and train.csv).
      - >-
        Notebook 01-preprocessing.ipynb loads raw CSVs with pandas, merges store metadata, performs feature engineering
        (e.g., mapping categorical codes, computing StoreId and Timestep), and writes cleaned training data to
        data/result/df.csv and encoded features to data/preprocessed/edf.csv.
      - >-
        The same notebook dummy-encodes categorical variables, reorders columns so that StoreId and Timestep lead and
        Sales is last, converts the dataframe into a 3D numpy feature cube (stores × timesteps × features+target) via
        make_cube, splits it into X_train and X_test, and saves them as .npz files in data/preprocessed/.
      - >-
        Notebook 02-model.ipynb loads X_train and X_test, converts them to JAX device arrays, and trains the
        Gamma-Poisson hierarchical model using ModelHandler.fit; it checkpoints optimizer state to
        data/result/optim_state.pickle and exports posterior summaries and predictions as CSVs in data/result/.
      - >-
        Notebook 03-evaluation.ipynb reads df.csv, df_edf.csv, parameter summaries (e.g., coef_mus.csv, stats.csv), and
        prediction CSVs from data/result/, and uses PlotStore and plot_densities to visualize store-level predictions
        and global/mean effects.
      - >-
        Core library modules (preprocess.py, model.py, handler.py, utils.py, plot.py) encapsulate reusable functionality
        for preprocessing, modelling, training, prediction, summarization, and visualization that the notebooks
        orchestrate.
    depsSummary:
      - >-
        Core numerical and data stack: numpy, scipy, pandas, scikit-learn, matplotlib, seaborn (declared in
        environment.yaml and used across notebooks).
      - >-
        Probabilistic programming and autodiff: JAX/jaxlib and NumPyro for model definition, random number generation,
        transforms, and stochastic variational inference (SVI).
      - >-
        Visualization and analysis: seaborn, matplotlib, and daft for plotting predictions, posterior densities, and the
        graphical model.
      - >-
        I/O and environment tooling: kaggle API for dataset download, pickle for optimizer state checkpointing, and
        JupyterLab for notebook-based experimentation.
      - >-
        Project scaffolding and testing: PyScaffold for project structure, pytest and pytest-cov for tests, and
        pre-commit hooks configuration.
    publicApis:
      - file: src/bhm_at_scale/handler.py
        name: ModelHandler
        path: bhm_at_scale.handler.ModelHandler
      - file: src/bhm_at_scale/handler.py
        name: ModelHandler.fit
        path: bhm_at_scale.handler.ModelHandler.fit
      - file: src/bhm_at_scale/handler.py
        name: ModelHandler.predict
        path: bhm_at_scale.handler.ModelHandler.predict
      - file: src/bhm_at_scale/model.py
        name: model
        path: bhm_at_scale.model.model
      - file: src/bhm_at_scale/model.py
        name: guide
        path: bhm_at_scale.model.guide
      - file: src/bhm_at_scale/model.py
        name: local_guide
        path: bhm_at_scale.model.local_guide
      - file: src/bhm_at_scale/model.py
        name: predictive_model
        path: bhm_at_scale.model.predictive_model
      - file: src/bhm_at_scale/preprocess.py
        name: encode
        path: bhm_at_scale.preprocess.encode
      - file: src/bhm_at_scale/preprocess.py
        name: make_cube
        path: bhm_at_scale.preprocess.make_cube
      - file: src/bhm_at_scale/plot.py
        name: PlotStore
        path: bhm_at_scale.plot.PlotStore
  codeOverview:
    components:
      - keyFiles:
          - notebooks/01-preprocessing.ipynb
          - src/bhm_at_scale/preprocess.py
          - src/bhm_at_scale/utils.py
        name: Preprocessing
        summary: >-
          Download Kaggle Rossmann data, perform data cleansing and basic feature engineering (e.g., mapping categorical
          codes, creating StoreId and Timestep), dummy-encode categorical variables, and build a 3D numpy cube of
          features and targets.
      - keyFiles:
          - src/bhm_at_scale/model.py
        name: Probabilistic Model
        summary: >-
          Implements a Gamma-Poisson Bayesian hierarchical model for daily store sales, with global and store-level
          coefficients over features such as weekday, promotions, holidays, and store variants.
      - keyFiles:
          - src/bhm_at_scale/handler.py
        name: Training and Inference Handler
        summary: >-
          Wraps NumPyro’s SVI training loop with JAX JIT compilation, optimizer state management, checkpointing, and
          prediction utilities for model and guide.
      - keyFiles:
          - notebooks/02-model.ipynb
          - notebooks/03-evaluation.ipynb
          - src/bhm_at_scale/plot.py
        name: Evaluation and Visualization
        summary: >-
          Reads posterior summaries and predictions, visualizes store-level time series with interventions (promotions,
          holidays) and posterior densities of feature effects.
      - keyFiles:
          - src/bhm_at_scale/utils.py
        name: Utility Functions
        summary: >-
          Provides helper functions for summary statistics, reshaping stats and predictions into dataframes, plotting
          intervals, and column reordering.
    entrypoints:
      - notebooks/01-preprocessing.ipynb
      - notebooks/02-model.ipynb
      - notebooks/03-evaluation.ipynb
    languages:
      - Python
  qualitySignals:
    complexityHints: []
    todoHotspots: []
  runtimePerf: {}
governance:
  assessments: []
  policies: []
  riskRegister: []
  signOffs: []
integration:
  driftSignals: []
  errorModel: []
  fallbacks:
    - >-
      A conventional linear regression baseline from scikit-learn is fit on log-transformed sales for a single store
      using nan-filled known-day features, then compared to the Bayesian model’s predictions to illustrate overfitting
      and coefficient interpretability.
    - >-
      This linear regression can serve as a simple fallback or comparison model when the full hierarchical Bayesian
      model is not available or fails to converge.
  observability: []
  operationalQualities: []
meta:
  createdAt: '2026-02-26T17:21:08.592Z'
  language: en
  lastUpdated: '2026-02-26T17:21:08.592Z'
  links:
    repo: https://github.com/FlorianWilhelm/bhm-at-scale
  maturity: PoC
  owners:
    - name: Florian Wilhelm
      role: Author
  tags:
    - bayesian
    - hierarchical modelling
    - sales forecasting
    - numpyro
    - jax
    - probabilistic programming
  title: Bayesian Hierarchical Modelling at Scale
mlCore:
  artifactURIs:
    dockerImage: ''
    model: data/result/optim_state.pickle
  baselines:
    - >-
      scikit-learn LinearRegression baseline fit on log-transformed daily sales for a single store using known-day
      features, used to illustrate overfitting compared to the Bayesian hierarchical model.
  datasets:
    - license: unknown
      name: Rossmann Store Sales (Kaggle)
      uri: kaggle://pratyushakar/rossmann-store-sales
  failureModes:
    - >-
      The model assumes a Gamma-Poisson count distribution for sales and may misrepresent data with strong
      zero-inflation patterns or non-count-like targets.
    - >-
      Closed days (Open == 0) are treated as missing targets (Sales set to NaN), so the model does not learn or predict
      explicit zero-sales behavior for such days; misuse on datasets where closure handling differs could distort
      forecasts.
    - >-
      The hierarchical model and guide are tailored to a fixed set of encoded features (DayOfWeek, Promo, StateHoliday,
      SchoolHoliday, Promo2, StoreVariant); applying the code without adjusting feature engineering and the Features
      index mapping can silently misalign coefficients and inputs.
  features:
    - DayOfWeek_1
    - DayOfWeek_2
    - DayOfWeek_3
    - DayOfWeek_4
    - DayOfWeek_5
    - DayOfWeek_6
    - DayOfWeek_7
    - Promo
    - StateHoliday_0
    - StateHoliday_1
    - StateHoliday_2
    - StateHoliday_3
    - SchoolHoliday
    - Promo2
    - StoreVariant_11
    - StoreVariant_13
    - StoreVariant_21
    - StoreVariant_22
    - StoreVariant_23
    - StoreVariant_31
    - StoreVariant_33
    - StoreVariant_41
    - StoreVariant_43
  problem: >-
    Hierarchical probabilistic regression for multi-store daily sales forecasting using a Gamma-Poisson model with
    shared and store-specific feature coefficients.
  qualities: []
  training:
    framework: NumPyro
    frameworkVersion: 0.7.2
    hardware: Local CPU environment (Conda environment with CPU-only JAX/NumPyro, as implied by environment.lock.yaml)
    hyperparams:
      batching: full-batch over all stores and days in X_train
      fine_tuning_epochs: 1000
      fine_tuning_learning_rate: 0.001
      initial_learning_rate: 0.1
      initial_training_epochs: 5000
      loss: Trace_ELBO(num_particles=1)
      optimizer: Adam
provenance:
  changelog:
    - date: '2026-02-26T17:22:01.598Z'
      files:
        - path: .coveragerc
        - path: .gitignore
        - path: .isort.cfg
        - path: .pre-commit-config.yaml
        - path: AUTHORS.rst
        - path: CHANGELOG.rst
        - path: LICENSE.txt
        - path: README.md
        - path: data/.gitignore
        - path: data/external/.gitignore
        - path: data/interim/.gitignore
        - path: data/preprocessed/.gitignore
        - path: data/raw/.gitignore
        - path: data/result/.gitignore
        - path: docs/Makefile
        - path: docs/_static/.gitignore
        - path: docs/authors.rst
        - path: docs/changelog.rst
        - path: docs/conf.py
        - path: docs/index.rst
        - path: docs/license.rst
        - path: docs/ml_system_card.yaml
        - path: docs/stakeholders.yaml
        - path: environment.lock.yaml
        - path: environment.yaml
        - path: notebooks/01-preprocessing.ipynb
        - path: notebooks/02-model.ipynb
        - path: notebooks/03-evaluation.ipynb
        - path: setup.cfg
        - path: setup.py
        - path: src/bhm_at_scale/__init__.py
        - path: src/bhm_at_scale/handler.py
        - path: src/bhm_at_scale/model.py
        - path: src/bhm_at_scale/plot.py
        - path: src/bhm_at_scale/preprocess.py
        - path: src/bhm_at_scale/utils.py
        - path: tests/conftest.py
      headSha: <redacted>
      runId: run-2026-02-26-17-21-39
      summary: ML System Card run run-2026-02-26-17-21-39 observed 37 changed files
    - date: '2026-02-26T17:22:01.598Z'
      files:
        - path: .coveragerc
        - path: .gitignore
        - path: .isort.cfg
        - path: .pre-commit-config.yaml
        - path: AUTHORS.rst
        - path: CHANGELOG.rst
        - path: LICENSE.txt
        - path: README.md
        - path: data/.gitignore
        - path: data/external/.gitignore
        - path: data/interim/.gitignore
        - path: data/preprocessed/.gitignore
        - path: data/raw/.gitignore
        - path: data/result/.gitignore
        - path: docs/Makefile
        - path: docs/_static/.gitignore
        - path: docs/authors.rst
        - path: docs/changelog.rst
        - path: docs/conf.py
        - path: docs/index.rst
        - path: docs/license.rst
        - path: docs/ml_system_card.yaml
        - path: docs/stakeholders.yaml
        - path: environment.lock.yaml
        - path: environment.yaml
        - path: notebooks/01-preprocessing.ipynb
        - path: notebooks/02-model.ipynb
        - path: notebooks/03-evaluation.ipynb
        - path: setup.cfg
        - path: setup.py
        - path: src/bhm_at_scale/__init__.py
        - path: src/bhm_at_scale/handler.py
        - path: src/bhm_at_scale/model.py
        - path: src/bhm_at_scale/plot.py
        - path: src/bhm_at_scale/preprocess.py
        - path: src/bhm_at_scale/utils.py
        - path: tests/conftest.py
      headSha: <redacted>
      runId: run-2026-02-26-17-21-39
      summary: ML System Card run run-2026-02-26-17-21-39 observed 37 changed files
  lastGeneratedAt: '2026-02-26T17:40:03.730Z'
stakeholderNotes: {}
